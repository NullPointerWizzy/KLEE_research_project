CC = clang
CC1 = gcc
CFLAGS = -std=c11 -Wall -Wextra -g -O2 -fprofile-arcs -ftest-coverage
LLVM_CFLAGS = -emit-llvm -c -g -O0 -Xclang -disable-O0-optnone
CPPFLAGS = -I ../include -I /home/thomas/Application/klee_with_uclibc/klee/include
LDFLAGS = -lm -L /home/thomas/Application/klee_with_uclibc/klee/build/lib/
LDLIBS = -lkleeRuntest

all: sudoku sudoku_final.bc

colors.o: colors.c ../include/colors.h
	$(CC1) $(CFLAGS) $(CPPFLAGS) -c $< -o $@ 

grid.o: grid.c ../include/grid.h ../include/colors.h
	$(CC1) $(CFLAGS) $(CPPFLAGS) -c $< -o $@ 

sudoku.o: sudoku.c sudoku.h ../include/grid.h
	$(CC1) $(CFLAGS) $(CPPFLAGS) -c $< -o $@

colors.bc: colors.c ../include/colors.h
	$(CC) $(LLVM_CFLAGS) $(CPPFLAGS) -c $< -o $@

grid.bc: grid.c ../include/grid.h ../include/colors.h
	$(CC) $(LLVM_CFLAGS) $(CPPFLAGS) -c $< -o $@

sudoku.bc: sudoku.c sudoku.h ../include/grid.h
	$(CC) $(LLVM_CFLAGS) $(CPPFLAGS) -c $< -o $@

sudoku: sudoku.o grid.o colors.o
	$(CC1) $(CFLAGS) -o $@ $^ $(LDFLAGS) $(LDLIBS)

sudoku_final.bc: colors.bc grid.bc sudoku.bc
	llvm-link $^ -o $@

clean:
	@rm -f *.o
	@rm -f *.bc
	@rm -f *.gcno
	@rm -f *.gcda
	@rm -f sudoku

help:
	@echo "Usage:"
	@echo " make [all]\t\tBuild"
	@echo " make clean\t\tRemove all files generated by make"
	@echo " make help\t\tDisplay this help"

.PHONY: all clean help
